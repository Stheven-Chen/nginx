import{r as o,a as oe,u as re,b as ie,j as e,c as ce}from"./index-85e0cf12.js";import{N as de,T as pe,M as ue}from"./mainBox-cd6b68eb.js";import{F as me}from"./fab-0ebbc665.js";import{I as he}from"./input-e1590388.js";import{f as N}from"./formatcurrency-03c19d79.js";import{u as xe}from"./today-9e8006eb.js";import{S as fe,M as je}from"./Modal-d5e4dd46.js";import{p as f}from"./postalCode-32098db5.js";import{u as ke}from"./useDispatch-0515d7d3.js";const De=()=>{const[t,m]=o.useState({polis:"",alamatObj:"",periode:"",okupasi:"",kelas:"",tsi:"",addedDate:"",type:"",diskon:"",komisi:"",startD:"",endD:"",sr:[{arah:"Kiri",okupasisr:"",jarak:""},{arah:"Kanan",okupasisr:"",jarak:""},{arah:"Depan",okupasisr:"",jarak:""},{arah:"Belakang",okupasisr:"",jarak:""}],prov:"",kota:"",kecamatan:"",kelurahan:"",EqZone:0}),[v,h]=o.useState(!1),[d,O]=o.useState({bangunan:"",content:""}),{username:R}=oe(n=>n.username),[F,T]=o.useState(""),[u,y]=o.useState([]),I=ke(),w=re(),x=xe(),E=o.useRef(null),b=o.useRef(null),[j,P]=o.useState(""),{state:q}=ie(),{insuredName:$,NIK:A,address:B,phone:L,email:M,COB:_,ktp:Z}=q,[z,W]=o.useState([]),[C,X]=o.useState(0),[S,p]=o.useState(0),[J,U]=o.useState([]),[Q,V]=o.useState([]),[Y,G]=o.useState([]),[H,ee]=o.useState([]),[D,ae]=o.useState(),[k,se]=o.useState({prov:"",kota:"",kecamatan:"",kelurahan:""}),l=n=>{const{name:a,value:r}=n.target;if(a==="startD"){const s=new Date(r),i=new Date(s.getFullYear()+1,s.getMonth(),s.getDate()+1);m(c=>({...c,addedDate:x,type:"New",[a]:r,endD:i.toISOString().split("T")[0]})),T(`${s.toISOString().split("T")[0].toString()} - ${i.toISOString().split("T")[0].toString()}`)}else if(a.startsWith("jarak")){const s=a.replace("jarak","");m(i=>({...i,sr:i.sr.map(c=>c.arah===s?{...c,jarak:r}:c)}))}else if(a.startsWith("okupasisr")){const s=a.replace("okupasisr","");m(i=>({...i,sr:i.sr.map(c=>c.arah===s?{...c,okupasisr:r}:c)}))}else a==="prov"||a==="kota"||a==="kecamatan"||a==="kelurahan"?(m(s=>({...s,addedDate:x,type:"New",[a]:r})),se(s=>({...s,[a]:n.target.selectedOptions[0].textContent}))):(m(s=>({...s,addedDate:x,type:"New",[a]:r})),O(s=>({...s,[a]:r})))},K=async(n,a,r)=>{const s={method:"POST"};try{return(await(await fetch(`https://agentserver.stheven.website/ratebenda?type=${n}&zone=${a}&rumah=${r}`,s)).json())[0].rate}catch(i){throw i}},g=async n=>{const a=n.target.value;if(n.target.checked){if(y([...u,a]),a==="rsmdcc"&&p(s=>s+5e-4),a==="tsfwd"&&p(s=>s+5e-4),a==="others"&&p(s=>s+5e-6),a==="eqvet"){let s="";t.okupasi==="Rumah Tinggal / 2976"?s="true":s="false";const i=await K("eq",t.EqZone,s);p(c=>c+i)}}else{if(y(u.filter(s=>s!==a)),a==="rsmdcc"&&p(s=>s-5e-4),a==="eqvet"){let s="";t.okupasi==="Rumah Tinggal / 2976"?s="true":s="false";const i=await K("eq",t.EqZone,s);p(c=>c-i)}a==="tsfwd"&&p(s=>s-5e-4),a==="others"&&p(s=>s-5e-6)}};o.useEffect(()=>{const n=E.current;if(n){const a={backgroundColor:"rgb(255, 255, 255)",penColor:"rgb(0, 0, 0)"};b.current=new fe(n,a),b.current.clear()}},[]);const te=()=>{var a;const n=(a=b.current)==null?void 0:a.toDataURL();n&&(P(n),h(!v)),console.log(j)};o.useEffect(()=>{(async()=>{try{const r=await(await fetch("https://agentserver.stheven.website/okupasi")).json();if(W(r),t.okupasi){const s=r.find(i=>i.okupasi===t.okupasi);console.log(s),s&&X(s.rate)}}catch(a){throw a}})()},[t.okupasi]),o.useEffect(()=>{(async()=>{let a="";const r=await f(a);if(U(r),t.prov){a=t.prov;const s=await f(a);V(s)}if(t.kota){a=t.kota;const s=await f(void 0,a);G(s)}if(t.kecamatan){a=t.kecamatan;const s=await f(void 0,void 0,a);ee(s),ne()}if(t.kelurahan){a=t.kelurahan;const s=await f(void 0,void 0,void 0,a);ae(s[0].postal_code)}})()},[t.prov,t.kota,t.kecamatan,t.kelurahan]);const ne=async()=>{const n={method:"POST"};try{const r=await(await fetch(`https://agentserver.stheven.website/eq?zona=${t.kota}`,n)).json();m(s=>({...s,EqZone:r[0].zona}))}catch(a){console.error(a)}},le=n=>{n.preventDefault(),I(ce({tsi:parseInt(d.bangunan.replace(/ /g,"").replace(/Rp/g,"").replace(/\./g,""))+parseInt(d.content.replace(/ /g,"").replace(/Rp/g,"").replace(/\./g,"")),polis:t.polis,alamatObj:`${t.alamatObj} ${k.kelurahan} ${k.kecamatan} ${k.kota} ${k.prov} -${D}`,periode:F,okupasi:t.okupasi,kelas:t.kelas,addedDate:t.addedDate,type:t.type,diskon:t.diskon,komisi:15-t.diskon,perluasan:u,sign:j,NIK:A,address:B,phone:L,email:M,COB:_,insuredName:$,status:"Approval",rate:S+C,ktp:Z,agentName:R,bangunan:parseInt(d.bangunan.replace(/ /g,"").replace(/Rp/g,"").replace(/\./g,"")),content:parseInt(d.content.replace(/ /g,"").replace(/Rp/g,"").replace(/\./g,"")),sr:t.sr,tjh:0,pa:0})),w("/application/")};return e.jsxs(e.Fragment,{children:[e.jsx(de,{}),e.jsx(pe,{}),e.jsx(ue,{content:e.jsxs(e.Fragment,{children:[v&&e.jsx(je,{handleClose:()=>h(!v),setSign:P,setShowModal:h,rateDasar:C,ratePerluasan:S,tsi:parseInt(d.bangunan.replace(/ /g,"").replace(/Rp/g,"").replace(/\./g,""))+parseInt(d.content.replace(/ /g,"").replace(/Rp/g,"").replace(/\./g,""))}),e.jsxs("form",{onSubmit:le,children:[e.jsx("span",{className:"font-semibold text-xl mb-5",children:"New Application"}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{className:"block mb-2",children:"Jenis Pertanggungan:"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"polis",value:"FLEXAS",checked:t.polis==="FLEXAS",onChange:l,className:"mr-2"}),e.jsx("span",{children:"FLEXAS"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"polis",value:"PAR",checked:t.polis==="PAR",onChange:l,className:"mr-2"}),e.jsx("span",{children:"PAR"})]})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{htmlFor:"alamatObj",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"Alamat Objek Pertanggungan"}),e.jsx(he,{id:"alamatObj",name:"alamatObj",placeholder:"",value:t.alamatObj,onChange:l,additionalStyles:"rounded-xl pl-3"})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{htmlFor:"prov",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"Provinsi:"}),e.jsxs("select",{id:"prov",name:"prov",value:t.prov,onChange:l,className:"rounded-xl pl-3 w-full h-10 mt-5 font-Poppins font-semibold",children:[e.jsx("option",{value:"",children:"Pilih Provinsi"}),J.map((n,a)=>e.jsx("option",{value:n,children:n},a))]})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{htmlFor:"kota",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"Kota:"}),e.jsxs("select",{id:"kota",name:"kota",value:t.kota,onChange:l,className:"rounded-xl pl-3 w-full h-10 mt-5 font-Poppins font-semibold",children:[e.jsx("option",{value:"",children:"Pilih Kota"}),Q.map((n,a)=>e.jsx("option",{value:n.city_id,children:n.kota},a))]})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{htmlFor:"kecamatan",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"Kecamatan:"}),e.jsxs("select",{id:"kecamatan",name:"kecamatan",value:t.kecamatan,onChange:l,className:"rounded-xl pl-3 w-full h-10 mt-5 font-Poppins font-semibold",children:[e.jsx("option",{value:"",children:"Pilih Kecamatan"}),Y.map((n,a)=>e.jsx("option",{value:n.dis_id,children:n.dis_name},a))]})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{htmlFor:"kelurahan",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"Kelurahan:"}),e.jsxs("select",{id:"kelurahan",name:"kelurahan",value:t.kelurahan,onChange:l,className:"rounded-xl pl-3 w-full h-10 mt-5 font-Poppins font-semibold",children:[e.jsx("option",{value:"",children:"Pilih Kelurahan"}),H.map((n,a)=>e.jsx("option",{value:n.subdis_id,children:n.subdis_name},a))]})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{htmlFor:"kodepos",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"Kode Pos:"}),e.jsx("input",{id:"kodepos",name:"kodepos",placeholder:"",value:D,onChange:l,className:"rounded-xl pl-3 w-full h-10 mt-5 p-3 font-Poppins font-semibold",type:"text"})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{htmlFor:"startD",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"Periode Pertanggungan:"}),e.jsxs("div",{className:"flex justify-between items-center gap-4",children:[e.jsx("input",{id:"startD",name:"startD",placeholder:"",value:t.startD,onChange:l,className:"rounded-xl pl-3 w-full h-10 mt-5 p-3 font-Poppins font-semibold",type:"date",min:x}),e.jsx("span",{className:"mt-5",children:"s/d"}),e.jsx("input",{id:"endD",name:"endD",placeholder:"",value:t.endD,onChange:l,className:"rounded-xl pl-3 w-full h-10 mt-5 p-3 font-Poppins font-semibold",type:"date",min:x})]})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{htmlFor:"okupasi",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"Okupasi:"}),e.jsxs("select",{id:"okupasi",name:"okupasi",value:t.okupasi,onChange:l,className:"rounded-xl pl-3 w-full h-10 mt-5 font-Poppins font-semibold",children:[e.jsx("option",{value:"",children:"Pilih okupasi"}),z.map((n,a)=>e.jsx("option",{value:n.okupasi,children:n.okupasi},a))]})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{htmlFor:"sr",className:"left-3 -top-2.5",children:"Surrounding Risk:"}),e.jsxs("table",{className:"w-full mt-4",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{className:"text-base font-normal",children:"Okupasi"}),e.jsx("th",{className:"text-base font-normal",children:"Jarak"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Kiri:"}),e.jsx("td",{children:e.jsx("input",{type:"text",id:"okupasisrKiri",name:"okupasisrKiri",value:t.sr[0].okupasisr,onChange:l,className:"w-full rounded-xl pl-3 h-10 font-Poppins font-semibold"})}),e.jsx("td",{children:e.jsx("input",{type:"text",id:"jarakKiri",name:"jarakKiri",value:t.sr[0].jarak,onChange:l,className:"w-full rounded-xl pl-3 h-10 font-Poppins font-semibold"})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Kanan:"}),e.jsx("td",{children:e.jsx("input",{type:"text",id:"okupasisrKanan",name:"okupasisrKanan",value:t.sr[1].okupasisr,onChange:l,className:"w-full rounded-xl pl-3 h-10 font-Poppins font-semibold"})}),e.jsx("td",{children:e.jsx("input",{type:"text",id:"jarakKanan",name:"jarakKanan",value:t.sr[1].jarak,onChange:l,className:"w-full rounded-xl pl-3 h-10 font-Poppins font-semibold"})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Depan:"}),e.jsx("td",{children:e.jsx("input",{type:"text",id:"okupasisrDepan",name:"okupasisrDepan",value:t.sr[2].okupasisr,onChange:l,className:"w-full rounded-xl pl-3 h-10 font-Poppins font-semibold"})}),e.jsx("td",{children:e.jsx("input",{type:"text",id:"jarakDepan",name:"jarakDepan",value:t.sr[2].jarak,onChange:l,className:"w-full rounded-xl pl-3 h-10 font-Poppins font-semibold"})})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Belakang:"}),e.jsx("td",{children:e.jsx("input",{type:"text",id:"okupasisrBelakang",name:"okupasisrBelakang",value:t.sr[3].okupasisr,onChange:l,className:"w-full rounded-xl pl-3 h-10 font-Poppins font-semibold"})}),e.jsx("td",{children:e.jsx("input",{type:"text",id:"jarakBelakang",name:"jarakBelakang",value:t.sr[3].jarak,onChange:l,className:"w-full rounded-xl pl-3 h-10 font-Poppins font-semibold"})})]})]})]})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{className:"block mb-2",children:"Perluasan:"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"perluasan",value:"tsfwd",checked:u.includes("tsfwd"),onChange:g,className:"mr-2"}),e.jsx("span",{children:"TSFWD"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"perluasan",value:"rsmdcc",checked:u.includes("rsmdcc"),onChange:g,className:"mr-2"}),e.jsx("span",{children:"RSMDCC"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"perluasan",value:"eqvet",checked:u.includes("eqvet"),onChange:g,className:"mr-2"}),e.jsx("span",{children:"EQVET"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"perluasan",value:"others",checked:u.includes("others"),onChange:g,className:"mr-2"}),e.jsx("span",{children:"Others"})]})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{htmlFor:"bangunan",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"Total Nilai Bangunan:"}),e.jsx("input",{id:"bangunan",name:"bangunan",placeholder:"",value:N(d.bangunan),onChange:l,className:"rounded-xl pl-3 w-full h-10 mt-5 p-3 font-Poppins font-semibold",type:"text"})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{htmlFor:"content",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"Total Nilai Content:"}),e.jsx("input",{id:"content",name:"content",placeholder:"",value:N(d.content),onChange:l,className:"rounded-xl pl-3 w-full h-10 mt-5 p-3 font-Poppins font-semibold",type:"text"})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{htmlFor:"tsi",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"Total Nilai Pertanggungan:"}),e.jsx("input",{id:"tsi",name:"tsi",placeholder:"",readOnly:!0,value:N((parseInt(d.bangunan.replace(/ /g,"").replace(/Rp/g,"").replace(/\./g,""))+parseInt(d.content.replace(/ /g,"").replace(/Rp/g,"").replace(/\./g,""))).toString()),onChange:l,className:"rounded-xl pl-3 w-full h-10 mt-5 p-3 font-Poppins font-semibold",type:"text"})]}),e.jsxs("div",{className:"relative my-5 rounded-xl border-solid border-2 border-gray-300 flex justify-center p-3 flex-col gap-3 shadow-lg",children:[j?e.jsx("img",{className:"rounded-xl",src:j,alt:"sign",onClick:()=>h(!0)}):e.jsx("div",{onClick:()=>h(!0),children:"Tanda Tangan Disini"}),e.jsx("div",{className:"flex justify-center items-center w-full"})]}),e.jsxs("div",{className:"w-full flex justify-between px-2",children:[e.jsx("button",{onClick:()=>{w("/application")},className:"bg-yellow-500 h-8 w-32 text-white font-Poppins rounded-xl transform-gpu transition-transform duration-300 active:scale-90",children:"Cancel"}),e.jsx("button",{onClick:te,type:"submit",className:"bg-sky-500 h-8 w-32 text-white font-Poppins rounded-xl transform-gpu transition-transform duration-300 active:scale-90",children:"Send"})]})]})]})}),e.jsx(me,{})]})};export{De as default};
