import{r,a as ee,u as ae,b as se,j as e,c as te}from"./index-85e0cf12.js";import{N as ne,T as le,M as ie}from"./mainBox-cd6b68eb.js";import{F as re}from"./fab-0ebbc665.js";import{I as M}from"./input-e1590388.js";import{f as C}from"./formatcurrency-03c19d79.js";import{u as oe}from"./today-9e8006eb.js";import{S as ce,M as de}from"./Modal-d5e4dd46.js";import{u as pe}from"./useDispatch-0515d7d3.js";const Ne=()=>{const[a,d]=r.useState({polis:"",periode:"",okupasi:"",merek:"",tsi:"",addedDate:"",type:"",model:"",year:"",mesin:"",rangka:"",plat:"",komisi:"",diskon:0,startD:"",endD:"",perluasan:[],wil:0,tjh:"",pa:""}),{username:R}=ee(t=>t.username),[F,h]=r.useState(!1),[o,x]=r.useState([]),[I,O]=r.useState([]),[A,E]=r.useState([]),J=pe(),P=ae(),f=oe(),[H,L]=r.useState(""),U=r.useRef(null),b=r.useRef(null),[k,S]=r.useState(""),{state:K}=se(),[p,D]=r.useState(0),[m,T]=r.useState(0),{insuredName:V,NIK:q,address:B,phone:Z,email:Q,COB:W}=K,[y,Y]=r.useState(0),[w,z]=r.useState(0),G=async(t,s,i)=>{if(a.tsi&&a.wil&&a.polis)try{const n=await(await fetch(`https://agentserver.stheven.website/ratemv?min=${t}&max=${t}&wil=${s}&type=${i}`,{method:"POST"})).json();D(n[0].rate)}catch(l){throw l}else D(0)},g=t=>{const{name:s}=t.target,i=t.target.value;s==="tjh"&&(d(l=>({...l,tjh:i})),j(void 0,void 0,"tjh")),s==="pa"&&(d(l=>({...l,pa:i})),j(void 0,void 0,"pa"))},j=async(t,s,i)=>{let l=0;try{if(i==="tjh"){const n=parseInt(a.tjh.replace(/ /g,"").replace(/Rp/g,"").replace(/\./g,"")),N=await(await fetch(`https://agentserver.stheven.website/ratemv?min=${n}&max=${n}&cover=${i}`,{method:"POST"})).json();Y(N[0].rate*n),console.log(`Premi TJH ${n} * ${N[0].rate} = ${y}`)}if(i==="pa"){const n=parseInt(a.pa.replace(/ /g,"").replace(/Rp/g,"").replace(/\./g,""));z(n*(.5/100)),console.log(`Premi PA ${n} * ${.5/100} = ${w}`)}if(t&&s&&i){const n=await fetch(`https://agentserver.stheven.website/ratemv?wil=${t}&type=${s}&cover=${i}`,{method:"POST"});if(n.ok)l=(await n.json())[0].rate;else throw new Error("Failed to fetch perluasan data")}}catch(n){console.error(n)}return l},c=async t=>{const{name:s,value:i}=t.target;if(s==="startD"){const l=new Date(i),n=new Date(l.getFullYear()+1,l.getMonth(),l.getDate()+1);d(u=>({...u,addedDate:f,type:"New",[s]:i,endD:n.toISOString().split("T")[0]})),L(`${l.toISOString().split("T")[0].toString()} - ${n.toISOString().split("T")[0].toString()}`)}else if(s==="plat"){const l=i.split(" ")[0];if(d(n=>({...n,[s]:i})),l)try{const n=await fetch(`https://agentserver.stheven.website/plat?plat=${l}`,{method:"POST"});if(n.ok){const u=await n.json();d(N=>({...N,[s]:i,wil:u.wil}))}else throw new Error("Failed to fetch wil data")}catch(n){console.error(n)}}else if(s==="tsi"){const l=i.replace(/[^0-9.]/g,"");d(n=>({...n,tsi:l})),G(parseInt(l.replace(/ /g,"").replace(/Rp/g,"").replace(/\./g,"")),a.wil,a.polis)}else d(l=>({...l,addedDate:f,type:"New",[s]:i}))},v=async t=>{const s=t.target.value;if(t.target.checked){x([...o,s]);const l=await j(a.wil,a.polis,s);T(n=>n+l)}else{x(o.filter(n=>n!==s));const l=await j(a.wil,a.polis,s);T(n=>n-l)}},$=async t=>{const s=t.target.value;t.target.checked?(x([...o,s]),(s==="tjh"||s==="pa")&&g(t)):(x(o.filter(l=>l!==s)),(s==="tjh"||s==="pa")&&g(t))};r.useEffect(()=>{const t=U.current;if(t){const s={backgroundColor:"rgb(255, 255, 255)",penColor:"rgb(0, 0, 0)"};b.current=new ce(t,s),b.current.clear()}},[]),r.useEffect(()=>{(async()=>{try{const i=await(await fetch("https://agentserver.stheven.website/")).json();if(O(i),a.merek){const l=i.find(n=>n.merek===a.merek);l&&E(l.model)}}catch(s){throw s}})()},[a.merek]);const X=()=>{var s;const t=(s=b.current)==null?void 0:s.toDataURL();t&&S(t)};r.useEffect(()=>{console.log(`rateDasar; ${p}`),console.log(`ratePerluasan; ${m}`),console.log(`Rate: ${m+p}`)},[m,p]);const _=t=>{t.preventDefault(),J(te({tsi:parseInt(a.tsi.replace(/ /g,"").replace(/Rp/g,"").replace(/\./g,"")),polis:a.polis,periode:H,okupasi:a.okupasi,addedDate:a.addedDate,type:a.type,merek:a.merek,model:a.model,year:a.year,mesin:a.mesin,plat:a.plat,rangka:a.rangka,diskon:a.diskon,komisi:25-a.diskon,perluasan:o,sign:k,NIK:q,address:B,phone:Z,email:Q,COB:W,insuredName:V,status:"Approval",agentName:R,rate:p+m,tjh:y,pa:w})),console.log(`
      rate ${p+m} premi: ${parseInt(a.tsi.replace(/ /g,"").replace(/Rp/g,"").replace(/\./g,""))*p+m}
      `),P("/application/")};return e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsx(le,{}),e.jsx(ie,{content:e.jsxs(e.Fragment,{children:[F&&e.jsx(de,{handleClose:()=>h(!1),setSign:S,setShowModal:h,tsi:parseInt(a.tsi.replace(/ /g,"").replace(/Rp/g,"").replace(/\./g,"")),rateDasar:p,ratePerluasan:m,premiTJH:y,premiPA:w}),e.jsxs("form",{onSubmit:_,children:[e.jsx("span",{className:"font-semibold text-xl mb-5",children:"New Application"}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{className:"block mb-2",children:"Jenis Pertanggungan:"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"polis",value:"Comprehensive",checked:a.polis==="Comprehensive",onChange:c,className:"mr-2"}),e.jsx("span",{children:"Comprehensive"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"polis",value:"tlo",checked:a.polis==="tlo",onChange:c,className:"mr-2"}),e.jsx("span",{children:"Total Loss Only"})]})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{htmlFor:"merek",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"Merek Kendaraan"}),e.jsxs("select",{name:"merek",id:"merek",value:a.merek,onChange:c,className:"rounded-xl pl-3 w-full h-10 mt-5 font-Poppins font-semibold",children:[e.jsx("option",{value:"",children:"Pilih merek"}),I.map((t,s)=>e.jsx("option",{value:t.merek,children:t.merek},s))]})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{htmlFor:"model",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"Model Kendaraan"}),e.jsxs("select",{name:"model",id:"model",value:a.model,onChange:c,className:"rounded-xl pl-3 w-full h-10 mt-5 font-Poppins font-semibold",children:[e.jsx("option",{value:"",children:"Pilih model"}),A.map((t,s)=>e.jsx("option",{value:t,children:t},s))]})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{htmlFor:"startD",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"Periode Pertanggungan:"}),e.jsxs("div",{className:"flex justify-between items-center gap-4",children:[e.jsx("input",{id:"startD",name:"startD",placeholder:"",value:a.startD,onChange:c,className:"rounded-xl pl-3 w-full h-10 mt-5 p-3 font-Poppins font-semibold",type:"date",min:f}),e.jsx("span",{className:"mt-5",children:"s/d"}),e.jsx("input",{id:"endD",name:"endD",placeholder:"",value:a.endD,onChange:c,className:"rounded-xl pl-3 w-full h-10 mt-5 p-3 font-Poppins font-semibold",type:"date",min:f})]})]}),e.jsxs("div",{className:" relative my-5 ",children:[e.jsx("label",{htmlFor:"plat",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"No Plat"}),e.jsx("input",{pattern:"[A-Z]{1,2}\\s\\d{1,4}\\s[A-Z]{1,3}",id:"plat",name:"plat",placeholder:"",value:a.plat.toUpperCase(),onChange:c,className:"rounded-xl pl-3 w-full h-10 mt-5 p-3 font-Poppins font-semibold"})]}),e.jsxs("div",{className:" relative my-5 ",children:[e.jsx("label",{htmlFor:"rangka",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"No Rangka"}),e.jsx(M,{id:"rangka",name:"rangka",placeholder:"",value:a.rangka.toUpperCase(),onChange:c,additionalStyles:"rounded-xl pl-3"})]}),e.jsxs("div",{className:" relative my-5 ",children:[e.jsx("label",{htmlFor:"mesin",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"No Mesin"}),e.jsx(M,{id:"mesin",name:"mesin",placeholder:"",value:a.mesin.toUpperCase(),onChange:c,additionalStyles:"rounded-xl pl-3"})]}),e.jsxs("div",{className:" relative my-5 ",children:[e.jsx("label",{htmlFor:"year",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"Tahun Pembuatan"}),e.jsx("input",{id:"year",name:"year",placeholder:"",value:a.year,onChange:c,className:"rounded-xl pl-3 w-full h-10 mt-5 p-3 font-Poppins font-semibold"})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{htmlFor:"okupasi",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"Penggunaan:"}),e.jsxs("select",{id:"okupasi",name:"okupasi",value:a.okupasi,onChange:c,className:"rounded-xl pl-3 w-full h-10 mt-5 font-Poppins font-semibold",children:[e.jsx("option",{value:"",children:"Pilih Penggunaan"}),e.jsx("option",{value:"Pribadi",children:"Pribadi"}),e.jsx("option",{value:"Niaga",children:"Niaga"}),e.jsx("option",{value:"Dinas",children:"Dinas"})]})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{htmlFor:"tsi",className:"absolute left-3 -top-2.5 transition-all duration-200",children:"Total Nilai Pertanggungan:"}),e.jsx("input",{id:"tsi",name:"tsi",placeholder:"",value:C(a.tsi),onChange:c,className:"rounded-xl pl-3 w-full h-10 mt-5 p-3 font-Poppins font-semibold",type:"text"})]}),e.jsxs("div",{className:"relative my-5",children:[e.jsx("label",{className:"block mb-2",children:"Perluasan"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"perluasan",value:"tshfl",checked:o.includes("tshfl"),onChange:v,className:"mr-2"}),e.jsx("span",{children:"TSHFL"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"perluasan",value:"rscc",checked:o.includes("rscc"),onChange:v,className:"mr-2"}),e.jsx("span",{children:"RSCC"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"perluasan",value:"eqvet",checked:o.includes("eqvet"),onChange:v,className:"mr-2"}),e.jsx("span",{children:"EQVET"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"perluasan",value:"tjh",checked:o.includes("tjh"),onChange:$,className:"mr-2"}),e.jsx("span",{children:"TJH"}),o.includes("tjh")&&e.jsx("input",{type:"text",name:"tjh",value:C(a.tjh),onChange:g,className:"rounded-xl ml-2 px-3 font-Poppins",placeholder:"Input nilai jaminan"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"perluasan",value:"pa",checked:o.includes("pa"),onChange:$,className:"mr-2"}),e.jsx("span",{children:"PA"}),o.includes("pa")&&e.jsx("input",{type:"text",name:"pa",value:C(a.pa),onChange:g,className:"rounded-xl ml-2 px-3 font-Poppins",placeholder:"Input nilai jaminan"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"perluasan",value:"ts",checked:o.includes("ts"),onChange:v,className:"mr-2"}),e.jsx("span",{children:"TS"})]})]}),e.jsxs("div",{className:"relative my-5 rounded-xl border-solid border-2 border-gray-300 flex justify-center p-3 flex-col gap-3 shadow-lg",children:[k?e.jsx("img",{className:"rounded-xl",src:k,alt:"sign",onClick:()=>h(!0)}):e.jsx("div",{onClick:()=>h(!0),children:"Tanda Tangan Disini"}),e.jsx("div",{className:"flex justify-center items-center w-full"})]}),e.jsxs("div",{className:"w-full flex justify-between px-2",children:[e.jsx("button",{onClick:()=>{P("/application")},className:"bg-yellow-500 h-8 w-32 text-white font-Poppins rounded-xl transform-gpu transition-transform duration-300 active:scale-90",children:"Cancel"}),e.jsx("button",{onClick:X,type:"submit",className:"bg-sky-500 h-8 w-32 text-white font-Poppins rounded-xl transform-gpu transition-transform duration-300 active:scale-90",children:"Send"})]})]})]})}),e.jsx(re,{})]})};export{Ne as default};
